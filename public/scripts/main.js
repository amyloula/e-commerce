"use strict";function fixHeaderScroll(){document.body.scrollTop>160||document.documentElement.scrollTop>160?document.getElementById("sticky").className="stick":document.getElementById("sticky").className=""}function FriendlyChat(){var e={view:"home"};history.pushState(e,"index.html"),this.checkSetup(),this.signInButton=document.getElementById("sign-in"),this.signOutButton=document.getElementById("sign-out"),this.shopping_bag=document.getElementById("shopping-bag"),$("#order-confirmation").hide(),$("#products-display").hide(),this.signOutButton.addEventListener("click",this.signOut.bind(this)),this.signInButton.addEventListener("click",this.signIn.bind(this)),this.shopping_bag.addEventListener("click",this.cartPreview.bind(this)),this.initFirebase()}window.onscroll=function(){fixHeaderScroll()},window.onpopstate=function(e){window.history.forward(1)},window.onbeforeunload=function(){window.history.forward(1)},FriendlyChat.prototype.initFirebase=function(){this.createCart(),this.auth=firebase.auth(),this.database=firebase.database(),this.storage=firebase.storage(),this.loadHeaderCats(this.loadHeaderCats.bind(this)),this.auth.onAuthStateChanged(this.onAuthStateChanged.bind(this)),this.carouselSetup()},FriendlyChat.prototype.loadHeaderCats=function(){var e=["Bras","Undies","Bikinis","Swimsuits","Activewear"],t=document.getElementById("header-banner-ul");t&&e.forEach(function(e){var o=document.createElement("li"),n=document.createTextNode(e);o.addEventListener("click",function(){FriendlyChat.prototype.loadProducts(this.id)}),o.id=e,o.className+="header-item",o.appendChild(n),t.appendChild(o)})},FriendlyChat.prototype.carouselSetup=function(){!function(){var e=document.querySelector(".carouselbox");if(e){var t=function(e){a.classList.remove("current"),(a=n[o=(o=(o+e)%i)<0?i-1:o]).classList.add("current")},o=0,n=e.querySelectorAll(".content li"),i=n.length,a=n[0];e.classList.add("active"),setInterval(function(e){t(1)},4e3),t(0)}}()},FriendlyChat.prototype.createCart=function(){if(null===localStorage.getItem("shopping_cart")){var e={};e.items=[];var t={};t.items=[],localStorage.setItem("shopping_cart",JSON.stringify(e)),localStorage.setItem("favourites_list",JSON.stringify(t)),localStorage.setItem("shipping",0),localStorage.setItem("total",0),localStorage.setItem("total_items",0)}document.getElementById("total").innerHTML="€"+localStorage.getItem("total"),document.getElementById("item-count").innerHTML="<p>"+localStorage.getItem("total_items")+"</p>"},FriendlyChat.prototype.cartPreview=function(){var e={view:"cart"};history.replaceState(e,"cart.html");var t=firebase.auth().currentUser;if(null!==t){var o=firebase.database().ref("users/"+t.uid).child("cart").child("items");t.displayName,t.email,t.photoURL,t.emailVerified;var n=void 0;o.on("child_added",function(e){console.log("new item found in the items array",e)}),o.on("child_changed",function(e){console.log("change found in the items array",e)}),o.on("child_removed",function(e){console.log("item removed from the items array",e)}),o.once("value",function(e){e.forEach(function(e){e.key;var t=e.val();return n=t})}),console.log(n)}var i=document.getElementById("cart-preview"),a=document.getElementById("checkout-btn");i.removeAttribute("hidden");for(var r=document.getElementById("product-ul"),s=document.getElementById("cart-ul"),c=localStorage.getItem("shopping_cart"),d=JSON.parse(c),l=d.items,u=document.getElementById("cart-total"),p=document.getElementById("shipping-total"),h=document.getElementById("subtotal"),m=l;r.firstChild;)r.removeChild(r.firstChild);if(a&&a.addEventListener("click",function(e){location.pathname="/cart.html"}),s)for(;s.firstChild;)s.removeChild(s.firstChild);if(m.forEach(function(e){var t=document.createElement("div"),o=document.createElement("div"),n=document.createElement("div"),a=document.createElement("img"),c=document.createElement("li"),d=document.createElement("p"),l=document.createElement("p"),m=document.createTextNode("Size: "+e.size),g=document.createElement("div"),f=document.createElement("p"),y=document.createTextNode(e.name),v=document.createTextNode("€"+e.price),C=document.createElement("p"),b=document.createTextNode("Qty:"+e.qty);return g.className+="color-dot",g.style.backgroundColor=e.colors,l.appendChild(m),t.className+="clearfix",a.className+="cart-img",d.className+="cart-product-name",f.className+="cart-product-price",o.className+="column1 menu",n.className+="column1 content1",a.src=e.img_url,o.appendChild(a),o.appendChild(g),d.appendChild(y),f.appendChild(v),f.appendChild(l),C.appendChild(b),n.appendChild(d),n.appendChild(f),n.appendChild(C),t.appendChild(o),t.appendChild(n),c.appendChild(t),s?(i.setAttribute("hidden",!0),u.innerHTML=localStorage.getItem("total"),p.innerHTML=localStorage.getItem("shipping"),h.innerHTML="Subtotal: "+localStorage.getItem("total"),s.appendChild(c)):r.appendChild(c)}),d.items);else{var g=document.createElement("div"),f=document.createTextNode("Whoops, your cart is empty!");g.appendChild(f),i.appendChild(g)}document.getElementById("close-cart").addEventListener("click",function(){i.setAttribute("hidden",!0)}),setTimeout(function(){i.setAttribute("hidden",!0)},3e3)},FriendlyChat.prototype.loadProducts=function(e){var t=firebase.database().ref().child("Products").child(e);"/faqs.html"===location.pathname&&(location.pathname="/"),$("#home-page").hide(),$(".carouselbox").hide(),$("#products-display").show(),t.once("value").then(function(t){var o=t.val(),n=document.getElementById("products-display"),i=document.createElement("h4"),a=document.createTextNode(e);for(i.appendChild(a);n.firstChild;)n.removeChild(n.firstChild);o.forEach(function(e){var t=document.createElement("div"),o=document.createElement("h4"),a=document.createTextNode(e.name),r=document.createElement("img"),s=document.createElement("h5"),c=document.createTextNode(e.price),d=document.createElement("button"),l=document.createElement("button");if(r.setAttribute("src",e.img_url),o.className+="product-name",d.innerHTML="Add to cart",d.className+="add-cart-button",d.productInfo=e,d.addEventListener("click",function(){FriendlyChat.prototype.addToCart(this)}),l.innerHTML="View product",l.className="view-product",l.productInfo=e,l.addEventListener("click",function(){FriendlyChat.prototype.viewProduct.apply(this)}),t.className+="product-tile",e.colors){var u=e.colors,p=document.createElement("div");u.forEach(function(e){var o=document.createElement("div");o.className="color-tile",p.className="tile-holder",o.style.backgroundColor=e.color,p.appendChild(o),t.appendChild(p)})}o.appendChild(a),s.appendChild(c),t.appendChild(r),t.appendChild(o),t.appendChild(s),t.appendChild(l),t.appendChild(d),n.appendChild(t),n.insertBefore(i,n.childNodes[0])})})},FriendlyChat.prototype.viewProduct=function(){var e={view:"product-view"};history.replaceState(e,"/"),$("#products-display").empty(),$(".carouselbox").hide();var t=this,o=document.createElement("div"),n=document.createElement("h3"),i=document.createTextNode(t.productInfo.name),a=document.createElement("div"),r=document.createElement("div"),s=document.createElement("div"),c=document.createElement("span"),d=document.createElement("div"),l=document.createTextNode("Add to my favourites"),u=document.createElement("img"),p=document.createElement("img"),h=document.createElement("img"),m=document.createElement("h5"),g=document.createTextNode(t.productInfo.price+" EUR"),f=document.createElement("h3"),y=document.createTextNode("Choose a tone"),v=t.productInfo.colors,C=document.createElement("div"),b=document.createElement("button"),E=document.createElement("div"),I=document.createElement("p"),N=document.createTextNode(t.productInfo.description),w=document.createElement("button"),S=document.createElement("div"),k=document.createElement("p"),T=document.createTextNode(t.productInfo.composition),F=document.createElement("button"),z=document.createElement("div");f.appendChild(y),C.className+="sizes-div",C.id+="sizes-div",w.className+="accordion change-font",b.className+="accordion change-font active",w.innerHTML+="Composition",b.innerHTML+="Description",w.onclick=function(){this.classList.toggle("active");var e=this.nextElementSibling;"block"===e.style.display?e.style.display="none":e.style.display="block"},b.onclick=function(){this.classList.toggle("active");var e=this.nextElementSibling;"block"===e.style.display?e.style.display="none":e.style.display="block"},S.className+="panel",E.className+="panel active",E.style.display="block",k.appendChild(T),I.appendChild(N),S.appendChild(k),E.appendChild(I),z.id="snackbar",F.innerHTML="Add to cart",F.className+="add-cart-button pr-view",F.productInfo=t,F.addEventListener("click",function(){FriendlyChat.prototype.addToCart(t)}),d.className+="fave-heart",c.appendChild(d),c.appendChild(l),o.className+="view-product-display",r.className+="column1 content view-content",n.className+="product-name",n.style.display="inline-block",s.productInfo=t.productInfo,s.addEventListener("click",function(){FriendlyChat.prototype.addToFavourites(this)}),s.className+="view-add-favourites",s.appendChild(c),a.className+="column1 menu pics",u.className+="preview-image",p.className+="mini-image",h.className+="mini-image",n.appendChild(i),u.src=t.productInfo.imgs[0],p.src=t.productInfo.imgs[1],h.src=t.productInfo.imgs[2],m.appendChild(g),a.appendChild(u),a.appendChild(p),a.appendChild(h),r.appendChild(a),r.appendChild(n),r.appendChild(s),r.appendChild(m),r.appendChild(f),v.forEach(function(e){var o=document.createElement("div");o.id=e.color,o.className+="color-dot",o.style.backgroundColor=e.color,r.appendChild(o),o.addEventListener("click",function(){$(this).addClass("active-color").siblings().removeClass("active-color"),e.productInfo=t.productInfo,t.productInfo.colors=$(this).attr("id"),FriendlyChat.prototype.getSizes(e)})}),r.appendChild(C),r.appendChild(b),r.appendChild(E),r.appendChild(w),r.appendChild(S),r.appendChild(F),r.appendChild(z),o.appendChild(a),o.appendChild(r),$("#products-display").append(o)},FriendlyChat.prototype.getSizes=function(e){var t=e,o=t.sizes,n=document.getElementById("sizes-div"),i=document.createElement("div");for(i.className+="warning-div",i.id+="warning-div";n.firstChild;)n.removeChild(n.firstChild);o.forEach(function(e){if(console.log(e),console.log(e.qty),e.qty<=0){var o=document.createElement("div");o.className+="size-span",o.innerHTML=e.size,o.addEventListener("click",function(){$(this).addClass("active-size").siblings().removeClass("active-size"),t.productInfo.size=$(this).html(),t.productInfo.qty=0,console.log(t.productInfo),FriendlyChat.prototype.stockQuantityWarningMessage(e)}),$("#sizes-div").append(o),$("#sizes-div").append(i)}else{var n=document.createElement("div");n.className+="size-span",n.innerHTML=e.size,n.addEventListener("click",function(){$(this).addClass("active-size").siblings().removeClass("active-size"),t.productInfo.size=$(this).html(),t.productInfo.qty=1,FriendlyChat.prototype.stockQuantityWarningMessage(e)}),$("#sizes-div").append(n),$("#sizes-div").append(i)}})},FriendlyChat.prototype.stockQuantityWarningMessage=function(e){for(var t=document.getElementById("warning-div");t.firstChild;)t.removeChild(t.firstChild);if(e.qty<=5){var o=document.createElement("div");o.className+="warning-stock-level",0!==e.qty&&e.qty&&void 0!==e.qty?o.innerHTML="Hurry! There's only "+e.qty+" left in stock":o.innerHTML="Whoops! You're too late, this item is sold out",t.appendChild(o),$("#sizes-div").append(t)}},FriendlyChat.prototype.addToFavourites=function(e){var t=firebase.auth().currentUser;$(".fave-heart").toggleClass("update-total"),null!=t&&(t.displayName,t.email,t.photoURL,t.emailVerified);var o=localStorage.getItem("favourites_list"),n=JSON.parse(o),i=n,a=i.items,r=e.productInfo;localStorage.setItem("favourites_list",JSON.stringify(i));var s=a.map(function(e){return e});if(n.items.length>0){var c=a.find(function(e){return e.size===r.size&&e.colors===r.colors&&e.name===r.name});if(c){var d=c.qty;c.qty=Number(d)+1,i.items=s}else a.push(r)}else 0===n.items.length&&a.push(r);if(t)return console.log("the user check is running correctly"),this.writeCartToUser(t,i,"favourites");console.log("the user check is not running properly"),localStorage.setItem("favourites_list",JSON.stringify(i))},FriendlyChat.prototype.warningToast=function(e){var t=document.getElementById("snackbar");t.className="show",t.innerHTML=e,setTimeout(function(){t.className=t.className.replace("show","")},3e3)},FriendlyChat.prototype.addToCart=function(e){var t=firebase.auth().currentUser;null!=t&&(t.displayName,t.email,t.photoURL,t.emailVerified);var o=localStorage.getItem("shopping_cart"),n=localStorage.getItem("total"),i=JSON.parse(o),a=i,r=JSON.parse(n),s=a.items,c=e.productInfo,d=document.getElementById("total"),l=document.getElementById("item-count");document.getElementById("shopping-bag");if($(".shopping-bag").toggleClass("add-to-cart"),$(".item-count").toggleClass("update-total"),console.log("this is the current item that is oging to be added to the cart",c),c.colors.length>1&&void 0===c.size){console.error("this item should not be added to the cart"),console.error(c.colors.length);var u=Array.isArray(c.colors)||void 0!==c.size?"Whoops! \n You must select the size and colour before you can add an item to the cart. \n Please try again":"Whoops! \n You must select the size before you can add an item to the cart. \n Please try again";FriendlyChat.prototype.warningToast(u)}else if(c.qty<=0){FriendlyChat.prototype.warningToast("Whoops. You're too late. This item is sold out. Please try another color or size.")}else{var p=Number(localStorage.getItem("total_items"))+1,h=s.map(function(e){return e});if(i.items.length>0){var m=s.find(function(e){return e.size===c.size&&e.colors===c.colors&&e.name===c.name});if(m){var g=m.qty;m.qty=Number(g)+1,a.items=h}else s.push(c)}else 0===s.length&&s.push(c);if(localStorage.setItem("shopping_cart",JSON.stringify(a)),localStorage.setItem("total",r+c.price),localStorage.setItem("total_items",JSON.stringify(p)),d.innerHTML="€"+localStorage.getItem("total"),l.innerHTML="<p>"+p+"</p>",this.cartPreview(),t)return console.log("the user check is running correctly"),this.writeCartToUser(t,a,"cart");console.log("the user check is not running properly")}},FriendlyChat.prototype.updateDataBaseAddProduct=function(e){console.log("this is the array of products",e),e.forEach(function(e){var t=firebase.database().ref().child("Products").child(e.category);t.once("value").then(function(o){var n=o.val();console.log("this is a response from the database when checking the category per product from cart",n),n.forEach(function(o,n){console.log("this is the index position whilst looping through the underwear products",n),o.name===e.name&&(console.log("this is the item where we need to edit the color qty",o),o.colors.indexOf(e.colors)&&(console.log("the color is included in the database color array",o),o.colors.forEach(function(o,i){o.color===e.colors&&(console.log("this is the exact color where we want to change the qty",o),o.sizes.forEach(function(o,a){if(console.log("size per color for matching color",o),console.log("index per color for matching color",i),o.size===e.size){var r=Number(o.qty)-1;console.log("this is the exact size whose QTY we need to edit",o,"index",a);t.child(n).child("colors").child(i).child("sizes").child(a).update({qty:r}).then(function(){console.log("woop woop. successfully updated the QTY of the object in the database")}).catch(function(e){console.error("Error writing new qty amount to Firebase Database",e)})}}))})))})})})},FriendlyChat.prototype.writeCartToUser=function(e,t,o){var n=e;firebase.database().ref("users/"+n.uid).child(o).set({items:[t.items]}).then(function(){console.log("woop woop. successfully added to the users cart object")}.bind(this)).then(function(){FriendlyChat.prototype.updateDataBaseAddProduct(t.items)}).catch(function(e){console.error("Error writing new message to Firebase Database",e)})},FriendlyChat.prototype.signIn=function(){var e=new firebase.auth.GoogleAuthProvider;this.auth.signInWithPopup(e)},FriendlyChat.prototype.signOut=function(){this.auth.signOut()},FriendlyChat.prototype.onAuthStateChanged=function(e){e?(this.signOutButton.removeAttribute("hidden"),this.signInButton.setAttribute("hidden","true"),this.saveMessagingDeviceToken()):(this.signOutButton.setAttribute("hidden","true"),this.signInButton.removeAttribute("hidden"))},FriendlyChat.prototype.checkSignedInWithMessage=function(){return!!firebase.auth().currentUser},FriendlyChat.prototype.saveMessagingDeviceToken=function(){firebase.messaging().getToken().then(function(e){e?(console.log("Got FCM device token:",e),firebase.database().ref("/fcmTokens").child(e).set(firebase.auth().currentUser.uid)):this.requestNotificationsPermissions()}.bind(this)).catch(function(e){console.error("Unable to get messaging token.",e)})},FriendlyChat.prototype.requestNotificationsPermissions=function(){console.log("Requesting notifications permission..."),firebase.messaging().requestPermission().then(function(){this.saveMessagingDeviceToken()}.bind(this)).catch(function(e){console.error("Unable to get permission to notify.",e)})},FriendlyChat.prototype.showQuestions=function(e){console.log(this);var t=this,o=[].slice.call(document.getElementsByClassName("faq-section"));[].slice.call(document.getElementsByClassName("faq-cats"));o.forEach(function(e){t.classList.toggle("active-faq"),t.id===e.title?(console.log("this is what you looking for"),e.removeAttribute("hidden")):e.setAttribute("hidden",!0)})},FriendlyChat.prototype.payPalCheckout=function(){var e=JSON.parse(localStorage.getItem("total")),t=JSON.parse(localStorage.getItem("shopping_cart")).items.map(function(e){var t={};return t.name=e.name,t.sku=e.name,t.price=e.price.toFixed(2),t.currency="EUR",t.quantity=e.qty,t});console.log(t),console.log(e),paypal.Button.render({env:"sandbox",client:{sandbox:"AVgU8_8H5pUASmivdzt9vVoiZLY5bByaYeBoepWJWxRzFw1tuhgzQoxCyYxJ79Snl6ik26zrjYXPUAC3"},commit:!0,payment:function(o,n){return n.payment.create({payment:{transactions:[{amount:{total:e,currency:"EUR"},item_list:{items:t}}]}})},onAuthorize:function(e,t){return t.payment.execute().then(function(e){console.log(e),$("#cart-page").hide(),$("#order-confirmation").show(),$("#order-preview").html("<h1>"+e.state+'</h1><div class="order-info"><h4>Order ID:'+e.id+"</h4> <h4>Status:"+e.state+"</h4></div>"),localStorage.setItem("total",0),localStorage.setItem("total_items",0);var t={};return t.items=[],localStorage.setItem("shopping_cart",JSON.stringify(t)),FriendlyChat.prototype.createCart()})}},"#paypal-button")},FriendlyChat.prototype.checkSetup=function(){window.firebase&&firebase.app instanceof Function&&firebase.app().options||window.alert("You have not configured and imported the Firebase SDK. Make sure you go through the codelab setup instructions and make sure you are running the codelab using `firebase serve`")},window.onload=function(){window.friendlyChat=new FriendlyChat};